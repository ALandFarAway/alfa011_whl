////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR Configuration File
//     Filename : acf_plc_onused.nss
//    $Revision:: 183        $ current version of the file
//        $Date:: 2006-12-21#$ date the file was created or modified
//       Author : Ronan
//
//  Local Variable Prefix =
//
//  Dependencies external of nwscript:
//
//  Description
//  This script calls the ACR's OnUsed code for placeables, and any
//  custom code a server may need. It is not updated in ACR updates.
//
//  Revision History
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

#include "acr_placeable_i"
#include "acr_xp_i"

////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

// The main event handler.
void main();

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void main() {
    ACR_PlaceableOnUsed();

    // Custom code goes here.
	object oPC = GetLastUsedBy();

	if (!GetIsPC(oPC)) return;

	int DoOnce = GetLocalInt(oPC, GetTag(OBJECT_SELF));

	if (DoOnce==TRUE) return;
	
	int iUntrained = GetHasSkill(SKILL_SPELLCRAFT, oPC);

	int nDC = 14;   // Difficulty of the check 
	int nRoll = d20(1);  // pre-generates the d20 roll 
	int nCheck = GetSkillRank(SKILL_SPELLCRAFT, oPC, FALSE);
	
	if (iUntrained == 0)
		{SendMessageToPC(oPC, "You do not understand the symbol.");
		 SetLocalInt(oPC, GetTag(OBJECT_SELF), TRUE);
		 return;}
	
	if (nRoll + nCheck >= nDC)
		{SendMessageToPC(oPC, "You see the alchemical symbol for sulphur.");
		ACR_AwardStaticQuestXP(oPC, "lockamber", 4);
		 SetLocalInt(oPC, GetTag(OBJECT_SELF), TRUE);
		 return;} 
	
	SendMessageToPC(oPC, "You do not understand the symbol.");	 
	SetLocalInt(oPC, GetTag(OBJECT_SELF), TRUE);
}