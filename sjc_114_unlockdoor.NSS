////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR Configuration File
//     Filename : acf_plc_oninventorydisturbed.nss
//    $Revision:: 188        $ current version of the file
//        $Date:: 2006-12-21#$ date the file was created or modified
//       Author : Ronan
//
//  Local Variable Prefix =
//
//  Dependencies external of nwscript:
//
//  Description
//  This script calls the ACR's OnDisturbed code for placeables, and any
//  custom code a server may need. It is not updated in ACR updates.
//
//  Revision History
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

#include "acr_placeable_i"

////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

// The main event handler.
void main();

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void main() {
    ACR_PlaceableOnDisturbed();

    // Custom code goes here.
	
	object oPC = GetLastDisturbed();
	object oSteel = GetObjectByTag("sjc_114_doorlocksteel");
	object oAmber = GetObjectByTag("sjc_114_doorlockamber");
	object oQuartz = GetObjectByTag("sjc_114_doorlockquartz");
	object oSteelunlock = GetObjectByTag("sjc_lyran_ball1");
	object oAmberunlock = GetObjectByTag("sjc_lyran_ball3");
	object oQuartzunlock = GetObjectByTag("sjc_lyran_ball2");
	object oDoor = GetObjectByTag("sjc_114_secretdoor");
	//int	nSpell =  
	
	if (GetFirstItemInInventory(oSteel) == OBJECT_INVALID) {return;}
	if (GetFirstItemInInventory(oQuartz) == OBJECT_INVALID) {return;}
	if (GetFirstItemInInventory(oAmber) == OBJECT_INVALID) {return;}
	
	if (GetFirstItemInInventory(oSteel) == oSteelunlock && GetFirstItemInInventory(oAmber) == oAmberunlock && GetFirstItemInInventory(oQuartz) == oQuartzunlock)
		{
		SetLocked(oDoor, FALSE);
		PlaySound("as_dr_secretdoor2_open");
		}
	else	
		{
		effect eVisual = EffectNWN2SpecialEffectFile("sp_magic_hit", oPC);
		ApplyEffectToObject(DURATION_TYPE_INSTANT, eVisual, oPC);
		effect eEffect = EffectDamage(1, DAMAGE_TYPE_ELECTRICAL, DAMAGE_POWER_NORMAL);
		ApplyEffectToObject(DURATION_TYPE_INSTANT, eEffect, oPC);
		}
}